<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard 2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .dashboard {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        .filters {
            margin-bottom: 20px;
        }
        label {
            margin-right: 10px;
        }
        select {
            margin-right: 20px;
            padding: 5px;
        }
        .data-table {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="filters">
            <label for="industryFilter">Industry:</label>
            <select id="industryFilter">
                <!-- Options will be dynamically populated here -->
            </select>

            <label for="nativityFilter">Nativity:</label>
            <select id="nativityFilter">
                <!-- Options will be dynamically populated here -->
            </select>
        </div>

        <div class="data-table">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>State</th>
                        <th>Industry</th>
                        <th>Nativity</th>
                        <th>Mean Wage</th>
                        <th>Mean Other Income</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will go here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Function to load CSV data and filter it based on slicers
        function loadCSVData() {
            fetch('aggregated_data.csv')
                .then(response => response.text())
                .then(data => {
                    const parsedData = parseCSV(data);
                    console.log('Parsed Data:', parsedData);  // Debugging line to check data
                    populateFilters(parsedData);
                    displayData(parsedData);
                })
                .catch(error => {
                    console.error('Error loading CSV:', error);
                });
        }

        // Parse CSV string into an array of objects
        function parseCSV(data) {
            const rows = data.split('\n');
            const headers = rows[0].split(',');
            const parsedData = rows.slice(1).map(row => {
                const values = row.split(',');
                let obj = {};
                headers.forEach((header, index) => {
                    obj[header.trim()] = values[index].trim();
                });
                return obj;
            });
            return parsedData;
        }

        // Populate the industry and nativity filters dynamically
        function populateFilters(data) {
            const industryFilter = document.getElementById('industryFilter');
            const nativityFilter = document.getElementById('nativityFilter');
            
            // Extract unique industries and nativities
            const industries = [...new Set(data.map(item => item.IND))];
            const nativities = [...new Set(data.map(item => item.NATIVITY))];

            // Add "All" option as default
            industries.unshift("All");
            nativities.unshift("All");

            // Add industries to the dropdown
            industries.forEach(industry => {
                const option = document.createElement('option');
                option.value = industry;
                option.textContent = industry;
                industryFilter.appendChild(option);
            });

            // Add nativities to the dropdown
            nativities.forEach(nativity => {
                const option = document.createElement('option');
                option.value = nativity;
                option.textContent = nativity;
                nativityFilter.appendChild(option);
            });

            // Set default values (first option in the list)
            industryFilter.value = industries[0];
            nativityFilter.value = nativities[0];
        }

        // Display data in the table
        function displayData(data) {
            const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';  // Clear existing table rows

            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.STATE}</td>
                    <td>${item.IND}</td>
                    <td>${item.NATIVITY}</td>
                    <td>${item.MEAN_WAGE}</td>
                    <td>${item.MEAN_OTHER_INCOME}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Filter data based on the selected slicers
        function filterData(data) {
            const industryFilterValue = document.getElementById('industryFilter').value;
            const nativityFilterValue = document.getElementById('nativityFilter').value;

            const filteredData = data.filter(item => {
                return (
                    (industryFilterValue === "All" || item.IND === industryFilterValue) &&
                    (nativityFilterValue === "All" || item.NATIVITY === nativityFilterValue)
                );
            });

            displayData(filteredData);
        }

        // Event listeners for filter changes
        document.getElementById('industryFilter').addEventListener('change', () => {
            loadCSVData();
        });

        document.getElementById('nativityFilter').addEventListener('change', () => {
            loadCSVData();
        });

        // Initialize data loading and filtering
        loadCSVData();
    </script>
</body>
</html>
